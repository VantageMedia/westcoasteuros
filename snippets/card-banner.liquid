{% comment %}
  Renders a customizable banner card.

  Accepts:
  - image: {Object} Optional. Image object.
  - title: {String} Optional. The title.
  - description: {String} Optional. The description.
  - button_link: {String} Optional. Button link.
  - button_text: {String} Optional. Button text.
  - show_title: {Boolean} Show title when true. Default true.
  - show_description: {Boolean} Show description when true. Default true.
  - show_button: {Boolean} Show button when true. Default true.
  - class: {String} Optional. CSS class.
  - ratio: {Number} Optional. The ratio to display the card at.
  - card_type: {String} Optional. The card's type.
  - columns {Number} Optional. The number of columns the card is rendered in.
  - id: {String} Optional. HTML id.
  - settings: {Object} Optional. The card settings.
  - settings.heading_size: {String} Title size for desktop.
  - settings.mobile_heading_size: {String} Title size for mobile.
  - settings.box_align: {String} Content alignment for desktop.
  - settings.mobile_box_align: {String} Content alignment for mobile.
  - settings.text_color: {String} Text color.
  - lazyload: {String} loading attribute string. 'lazy' or 'eager'. Default empty.

  Usage:
  {% render 'card-banner' title: title, image: image %}
{% endcomment %}

{% liquid
  if ratio == null
    assign ratio = 1
  endif

  assign has_title = true
  if title == blank or show_title == false
    assign has_title = false
  endif
  assign has_description = true
  if description == blank or show_description == false
    assign has_description = false
  endif
  assign has_button = true
  if show_button == false or button_text == blank or button_link == blank
    assign has_button = false
  endif

  assign has_video = false
  if settings.custom_video != blank or settings.video_url != blank
    assign has_video = true
  endif

  assign video_type = settings.video_url.type
  if settings.custom_video != blank
    assign video_type = 'self-hosted'
  endif
%}

<div
  {% if id != blank %}
    id="{{ id }}"
  {% endif %}
  class="card card-banner card-banner-{{ card_type }} {% if mobile_image %}card-with-mobile-media{% endif %} {{ class }}"
>
  <div class="card-media">
    {% if button_link %}
      <a href="{{ button_link }}">
    {% endif %}
    {% if image != blank %}
      {%- capture image_sizes -%}
					{% if columns == 1 or card_type == 'media' %}
						(min-width: 1540px) 1540px, calc(100vw - 3rem)
					{% else %}
						(min-width: 1200px) calc((100vw - 6rem) / 2), (min-width: 990px) calc((100vw - 6rem) * 0.6), (min-width: 750px) calc(100vw - 4rem), calc(100vw - 3rem)
					{% endif %}
				{%- endcapture -%}

      <picture>
        {% if mobile_image %}
          <source
            srcset="
              {% if mobile_image.width >= 375 %}{{ mobile_image | image_url: width: 165 }} 165w,{% endif %}
              {% if mobile_image.width >= 440 %}{{ mobile_image | image_url: width: 440 }} 440w,{% endif %}
              {% if mobile_image.width >= 650 %}{{ mobile_image | image_url: width: 650 }} 650w,{% endif %}
              {% if mobile_image.width >= 850 %}{{ mobile_image | image_url: width: 850 }} 850w,{% endif %}
              {% if mobile_image.width >= 1100 %}{{ mobile_image | image_url: width: 1100 }} 1100w,{% endif %}
              {% if mobile_image.width >= 1200 %}{{ mobile_image | image_url: width: 1200 }} 1200w,{% endif %}
              {% if mobile_image.width >= 1540 %}{{ mobile_image | image_url: width: 1540 }} 1540w,{% endif %}
              {{ mobile_image | image_url }} {{ mobile_image.width }}w
            "
            sizes="{{ image_sizes }}"
            {% if mobile_image != blank %}
              media="(max-width: 749px)"
            {% endif %}
          >
        {% endif %}

        <source
          srcset="
            {% if image.width >= 375 %}{{ image | image_url: width: 375 }} 375w,{% endif %}
            {% if image.width >= 440 %}{{ image | image_url: width: 440 }} 440w,{% endif %}
            {% if image.width >= 650 %}{{ image | image_url: width: 650 }} 650w,{% endif %}
            {% if image.width >= 850 %}{{ image | image_url: width: 850 }} 850w,{% endif %}
            {% if image.width >= 1100 %}{{ image | image_url: width: 1100 }} 1100w,{% endif %}
            {% if image.width >= 1200 %}{{ image | image_url: width: 1200 }} 1200w,{% endif %}
            {% if image.width >= 1540 %}{{ image | image_url: width: 1540 }} 1540w,{% endif %}
            {{ image | image_url }} {{ image.width }}w
          "
          sizes="{{ image_sizes }}"
          {% if mobile_image != blank %}
            media="(min-width: 750px)"
          {% endif %}
        >

        {{
          image
          | image_url: width: 1540
          | image_tag:
            class: 'card-media-image',
            loading: lazyload,
            fetchpriority: fetch_priority,
            sizes: image_sizes,
            widths: '165, 440, 650, 850, 1100, 1200, 1540'
        }}
      </picture>
    {% else %}
      {% if has_video == false %}
        <div class="card-placeholder background-complementary">
          {{ 'collection-1' | strip | placeholder_svg_tag: 'card-media-image' }}
        </div>
      {% endif %}
    {% endif %}

    {% unless title == blank %}
      <span class="visually-hidden">{{ title }}</span>
    {% endunless %}

    {% if button_link %}
      </a>
    {% endif %}
  </div>

  <div
    class="card-info-wrap  {% if settings.text_color != blank %}card-custom-color{% endif %} content-align-{{ settings.mobile_box_align }} content-align-desktop-{{ settings.box_align }}"
    style="--card-ratio: {{ ratio }};"
  >
    {%- if has_title or has_description or has_button -%}
      <div
        class="card-info"
        {% if settings.text_color != blank %}
          style="color: {{ settings.text_color }}"
        {% endif %}
      >
        <div class="card-info-inner">
          {%- if has_title -%}
            <h3 class="card-heading card-heading-{{ settings.mobile_heading_size }} card-heading-desktop-{{ settings.heading_size }}">
              {%- if button_link -%}
                <a href="{{ button_link }}">
              {%- endif -%}
              {{ title }}
              {%- if button_link -%}
                </a>
              {%- endif -%}
            </h3>
          {%- endif -%}

          {%- if has_description -%}
            <div class="card-caption">
              {{ description }}
            </div>
          {%- endif -%}
        </div>

        {%- if has_button -%}
          <a
            href="{{ button_link }}"
            class="{% if settings.button_type_link %}button-text-link{% else %}button color-button-{{ settings.button_color_scheme }} {% if card_type == 'media' %}button-large-desktop{% endif %}{% endif %}"
          >
            {{ button_text }}
          </a>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>

  {% if settings.badge_overlay_line_1_text != blank
    or settings.badge_overlay_line_2_text != blank
    or settings.badge_overlay_line_3_text != blank
  %}
    <div
      class="card-badge-overlay card-badge-overlay-position-{{ settings.badge_overlay_position }}"
      style="color: {{ settings.badge_overlay_colors_text }}; background-color: {{ settings.badge_overlay_colors_background }};"
    >
      {% if settings.badge_overlay_line_1_text != blank %}
        <span class="card-badge-overlay-text card-badge-overlay-text-1 card-badge-overlay-text-{{ settings.badge_overlay_line_1_font_size }}">
          {{ settings.badge_overlay_line_1_text }}
        </span>
      {% endif %}
      {% if settings.badge_overlay_line_2_text != blank %}
        <span class="card-badge-overlay-text card-badge-overlay-text-2 card-badge-overlay-text-{{ settings.badge_overlay_line_2_font_size }}">
          {{ settings.badge_overlay_line_2_text }}
        </span>
      {% endif %}
      {% if settings.badge_overlay_line_3_text != blank %}
        <span class="card-badge-overlay-text card-badge-overlay-text-3 card-badge-overlay-text-{{ settings.badge_overlay_line_3_font_size }}">
          {{ settings.badge_overlay_line_3_text }}
        </span>
      {% endif %}
    </div>
  {% endif %}

  {% if has_video %}
    <video-background
      data-section-id="{{ id }}"
      data-type="{{ video_type }}"
      data-video-id="{{ settings.video_url.id }}"
      class="card-overlay-video-background"
    >
      <div class="video-background-loader"></div>
      <div class="video-background-player">
        {%- if settings.custom_video != blank -%}
          <video muted playsinline preload="none" loop>
            {% for source in settings.custom_video.sources %}
              <source data-src="{{ source.url }}" type="{{ source.mime_type }}">
            {% endfor %}
          </video>
        {%- else -%}
          <div id="{{ id }}-video-player"></div>
        {%- endif -%}

        {% if settings.video_description != blank %}
          <span class="visually-hidden">{{ settings.video_description }}</span>
        {% endif %}
      </div>
    </video-background>
  {% endif %}
</div>

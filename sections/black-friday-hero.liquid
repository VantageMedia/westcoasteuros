{% liquid
  assign is_empty = true
  for block in section.blocks
    if block.settings.main_heading != blank or block.settings.sub_heading != blank
      assign is_empty = false
    endif
  endfor

  assign hide_because_empty = false
  if request.design_mode == false and section.settings.hide_if_empty and is_empty
    assign hide_because_empty = true
  endif
%}
{%- unless hide_because_empty -%}
  {{ 'section-black-friday-hero.css' | asset_url | stylesheet_tag }}
  {{ 'component-countdown.css' | asset_url | stylesheet_tag }}
  
  {% if section.blocks.first.settings.show_countdown %}
    <script src="{{ 'countdown.js' | asset_url }}" defer="defer"></script>
  {% endif %}

  {% liquid
    assign color_scheme_string = section.settings.color_scheme | append: ''
    assign block_section_class = 'block-section'
    unless color_scheme_string == 'background-1'
      assign block_section_class = block_section_class | append: ' block-section-padded'
    endunless
  %}

  <style>
    #shopify-section-{{ section.id }} .block-section {
      margin-top: {{ section.settings.spacing_top | times: 0.8 | round: 0 }}px;
      margin-bottom: {{ section.settings.spacing_bottom | times: 0.8 | round: 0 }}px;
    }

    #shopify-section-{{ section.id }} .block-section-padded {
      margin-top: 0;
      margin-bottom: 0;
      padding-top: {{ section.settings.spacing_top | times: 0.8 | round: 0 }}px;
      padding-bottom: {{ section.settings.spacing_bottom | times: 0.8 | round: 0 }}px;
    }

    @media (min-width: 990px) {
      #shopify-section-{{ section.id }} .block-section {
        margin-top: {{ section.settings.spacing_top }}px;
        margin-bottom: {{ section.settings.spacing_bottom }}px;
      }

      #shopify-section-{{ section.id }} .block-section-padded {
        margin-top: 0;
        margin-bottom: 0;
        padding-top: {{ section.settings.spacing_top }}px;
        padding-bottom: {{ section.settings.spacing_bottom }}px;
      }
    }

    #shopify-section-{{ section.id }} .black-friday-hero {
      --overlay-opacity: {{ section.blocks.first.settings.overlay_opacity | default: 0.4 }};
    }
  </style>

  {%- capture visibility_classes -%}{%- render 'section-visibility-classes' -%}{%- endcapture -%}
  {%- assign visibility_classes = visibility_classes | strip -%}

  <div class="{{ visibility_classes }}">
    <div class="color-{{ section.settings.color_scheme }}">
      <div class="{% if section.settings.full_width %} block-section-fullwidth{% else %} container{% endif %}">
        <div class="{{ block_section_class }}">
          {% for block in section.blocks %}
            <div class="black-friday-hero" {{ block.shopify_attributes }}>
              <div class="black-friday-hero-background">
                {% if block.settings.background_image != blank %}
                  <picture>
                    {% if block.settings.mobile_background_image != blank %}
                      <source media="(max-width: 749px)" srcset="{{ block.settings.mobile_background_image | image_url: width: 750 }}">
                    {% endif %}
                    {{
                      block.settings.background_image
                      | image_url: width: 1920
                      | image_tag:
                        class: 'black-friday-hero-image',
                        loading: 'eager',
                        fetchpriority: 'high'
                    }}
                  </picture>
                {% else %}
                  <div class="black-friday-hero-placeholder">
                    {{ 'lifestyle-1' | placeholder_svg_tag: 'black-friday-hero-image' }}
                  </div>
                {% endif %}
                
                <div class="black-friday-hero-overlay"></div>
              </div>

              <div class="black-friday-hero-content">
                <div class="container">
                  <div class="black-friday-hero-text">
                    {% if block.settings.main_heading != blank %}
                      <h1 class="black-friday-hero-main-heading">
                        {{ block.settings.main_heading | escape }}
                      </h1>
                    {% endif %}

                    {% if block.settings.sub_heading != blank %}
                      <h2 class="black-friday-hero-sub-heading">
                        {{ block.settings.sub_heading | escape }}
                      </h2>
                    {% endif %}

                    {% if block.settings.description != blank %}
                      <p class="black-friday-hero-description">
                        {{ block.settings.description | escape }}
                      </p>
                    {% endif %}

                    {% if block.settings.show_countdown and block.settings.countdown_date != blank %}
                      <div class="black-friday-countdown" data-countdown-date="{{ block.settings.countdown_date }}">
                        <div class="countdown-timer">
                          <div class="countdown-item">
                            <span class="countdown-number" data-days>00</span>
                            <span class="countdown-label">Days</span>
                          </div>
                          <div class="countdown-item">
                            <span class="countdown-number" data-hours>00</span>
                            <span class="countdown-label">Hours</span>
                          </div>
                          <div class="countdown-item">
                            <span class="countdown-number" data-minutes>00</span>
                            <span class="countdown-label">Minutes</span>
                          </div>
                          <div class="countdown-item">
                            <span class="countdown-number" data-seconds>00</span>
                            <span class="countdown-label">Seconds</span>
                          </div>
                        </div>
                      </div>
                    {% endif %}

                    {% if block.settings.cta_text != blank and block.settings.cta_link != blank %}
                      <div class="black-friday-hero-cta">
                        <a href="{{ block.settings.cta_link }}" class="button button-primary button-large">
                          {{ block.settings.cta_text | escape }}
                        </a>
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
{%- endunless -%}

{% schema %}
{
  "name": "Black Friday Hero",
  "tag": "section",
  "class": "section-black-friday-hero",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "default": true,
      "label": "Make section full width"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "accent-1"
    },
    {
      "type": "range",
      "id": "spacing_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top spacing",
      "default": 0
    },
    {
      "type": "range",
      "id": "spacing_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom spacing",
      "default": 0
    },
    {
      "type": "header",
      "content": "Section visibility"
    },
    {
      "type": "checkbox",
      "id": "hide_if_empty",
      "default": false,
      "label": "Hide section if empty"
    }
  ],
  "blocks": [
    {
      "type": "hero-content",
      "name": "Hero Content",
      "limit": 1,
      "settings": [
        {
          "type": "image_picker",
          "id": "background_image",
          "label": "Background image"
        },
        {
          "type": "image_picker",
          "id": "mobile_background_image",
          "label": "Mobile background image"
        },
        {
          "type": "text",
          "id": "main_heading",
          "default": "BLACK FRIDAY",
          "label": "Main heading"
        },
        {
          "type": "text",
          "id": "sub_heading",
          "default": "Your Modding Journey Just Got Cheaper",
          "label": "Sub heading"
        },
        {
          "type": "textarea",
          "id": "description",
          "default": "Up to 70% OFF on premium BMW parts. Limited time. Limited stock.",
          "label": "Description"
        },
        {
          "type": "text",
          "id": "cta_text",
          "default": "Shop Black Friday Deals",
          "label": "Button text"
        },
        {
          "type": "url",
          "id": "cta_link",
          "label": "Button link"
        },
        {
          "type": "checkbox",
          "id": "show_countdown",
          "default": true,
          "label": "Show countdown timer"
        },
        {
          "type": "text",
          "id": "countdown_date",
          "label": "Countdown end date",
          "info": "Format: YYYY-MM-DDTHH:MM:SS (e.g., 2024-12-01T23:59:59)"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "min": 0,
          "max": 1,
          "step": 0.1,
          "default": 0.4,
          "label": "Overlay opacity"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Black Friday Hero",
      "blocks": [
        {
          "type": "hero-content"
        }
      ]
    }
  ]
}
{% endschema %}
